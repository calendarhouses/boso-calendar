<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BOSO Booking</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <style>
        body { font-family: 'Segoe UI', sans-serif; padding: 20px; text-align: center; background-color: #f9f6f0; overflow-x: hidden; }
        .bosman-avatar { width: 120px; height: 120px; border-radius: 50%; border: 4px solid #8f9779; margin-bottom: 10px; object-fit: cover; transition: 0.3s; }
        
        .step-container { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); max-width: 320px; margin: 0 auto; display: none; opacity: 0; transform: translateY(10px); transition: all 0.4s ease; }
        .step-container.active { display: block; opacity: 1; transform: translateY(0); }
        
        h2 { color: #2c3e50; font-size: 20px; margin-top: 5px; margin-bottom: 5px; }
        p.subtitle { color: #7f8c8d; font-size: 14px; margin-top: 0; margin-bottom: 20px; }
        
        input { width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; text-align: center; font-size: 16px; outline: none; box-sizing: border-box; margin-bottom: 15px; }
        input:focus { border-color: #8f9779; }
        
        button { background-color: #8f9779; color: white; border: none; padding: 15px; width: 100%; border-radius: 8px; font-weight: bold; font-size: 16px; cursor: pointer; transition: 0.2s; margin-bottom: 10px; }
        button:active { transform: scale(0.98); background-color: #7a8266; }
        .btn-outline { background-color: white; color: #8f9779; border: 2px solid #8f9779; }
        
        #message { margin-top: 15px; font-weight: bold; color: #8f9779; display: none; }
    </style>
</head>
<body>

    <img id="main-img" src="bosman.jpg" alt="–ö–∞–ø—ñ—Ç–∞–Ω –ë–æ—Å–º–∞–Ω" class="bosman-avatar" onerror="this.src='https://via.placeholder.com/120?text=BOSO'">
    <h2 id="main-title">–û–±–µ—Ä—ñ—Ç—å –¥–∞—Ç–∏ –≤—ñ–¥–ø–æ—á–∏–Ω–∫—É ‚öì</h2>
    <p id="main-subtitle" class="subtitle">–ö–æ–ª–∏ –ø–ª–∞–Ω—É—î—Ç–µ –∑–∞—ó–∑–¥ —Ç–∞ –≤–∏—ó–∑–¥?</p>

    <div id="step-1" class="step-container active">
        <input type="text" id="dateRange" placeholder="–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –¥–ª—è –≤–∏–±–æ—Ä—É..." readonly>
        <button onclick="goToStep2()">–î–∞–ª—ñ</button>
    </div>

    <div id="step-2" class="step-container">
        <input type="number" id="guestsInput" placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥: 2" min="1" max="10">
        <button onclick="goToStep3()">–î–∞–ª—ñ</button>
        <button class="btn-outline" onclick="goBack(1)" style="padding: 10px; font-size: 14px; margin-top: 5px;">–ù–∞–∑–∞–¥</button>
    </div>

    <div id="step-3" class="step-container">
        <button onclick="goToStep4('–¢–∞–∫')">üê∂ –¢–∞–∫, –º–∏ –∑ —Ö–≤–æ—Å—Ç–∏–∫–æ–º</button>
        <button class="btn-outline" onclick="goToStep4('–ù—ñ')">–ù—ñ, –±–µ–∑ —Ç–≤–∞—Ä–∏–Ω</button>
        <button class="btn-outline" onclick="goBack(2)" style="border: none; margin-top: 10px;">–ù–∞–∑–∞–¥</button>
    </div>

    <div id="step-4" class="step-container">
        <button onclick="submitData('–¢–∞–∫')">‚ô®Ô∏è –¢–∞–∫, –æ–±–æ–≤'—è–∑–∫–æ–≤–æ!</button>
        <button class="btn-outline" onclick="submitData('–ù—ñ')">–ù—ñ, –¥—è–∫—É—é</button>
        <button class="btn-outline" onclick="goBack(3)" style="border: none; margin-top: 10px;">–ù–∞–∑–∞–¥</button>
    </div>

    <div id="message">‚öì –ü–µ—Ä–µ–¥–∞—é –¥–∞–Ω—ñ...</div>

    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://npmcdn.com/flatpickr/dist/l10n/uk.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <script>
        const tg = window.Telegram.WebApp;
        if (tg) { tg.expand(); tg.ready(); }

        const urlParams = new URLSearchParams(window.location.search);
        const userId = tg.initDataUnsafe?.user?.id || urlParams.get('user_id');

        let finalCheckIn = "", finalCheckOut = "", finalGuests = "", finalPets = "";

        const fp = flatpickr("#dateRange", { mode: "range", minDate: "today", locale: "uk", dateFormat: "Y-m-d" });

        function updateHeader(title, subtitle) {
            document.getElementById('main-title').innerText = title;
            document.getElementById('main-subtitle').innerText = subtitle;
        }

        function showStep(stepNumber) {
            document.querySelectorAll('.step-container').forEach(el => el.classList.remove('active'));
            setTimeout(() => { document.getElementById('step-' + stepNumber).classList.add('active'); }, 50);
        }

        function goToStep2() {
            if (fp.selectedDates.length < 2) { alert("‚öì –û–±–µ—Ä—ñ—Ç—å –∑–∞—ó–∑–¥ —Ç–∞ –≤–∏—ó–∑–¥!"); return; }
            finalCheckIn = fp.formatDate(fp.selectedDates[0], "Y-m-d");
            finalCheckOut = fp.formatDate(fp.selectedDates[1], "Y-m-d");
            updateHeader("–°–∫—ñ–ª—å–∫–∏ –≤–∞—Å –±—É–¥–µ?", "–í–∫–∞–∂—ñ—Ç—å –∫—ñ–ª—å–∫—ñ—Å—Ç—å –æ—Å—ñ–±"); showStep(2);
        }

        function goToStep3() {
            const guests = document.getElementById('guestsInput').value;
            if (!guests || guests < 1) { alert("–í–∫–∞–∂—ñ—Ç—å –∫—ñ–ª—å–∫—ñ—Å—Ç—å –≥–æ—Å—Ç–µ–π!"); return; }
            finalGuests = guests;
            updateHeader("–í–∏ –∑ –ø—É—Ö–Ω–∞—Å—Ç–∏–∫–æ–º?", "–ú–∏ –¥—Ä—É–∂–Ω—ñ –¥–æ —Ç–≤–∞—Ä–∏–Ω"); showStep(3);
        }

        function goToStep4(petAnswer) {
            finalPets = petAnswer;
            updateHeader("–ë–∞–∂–∞—î—Ç–µ –≥–∞—Ä—è—á–∏–π —á–∞–Ω?", "–Ü–¥–µ–∞–ª—å–Ω–æ –¥–ª—è –≤–µ—á—ñ—Ä–Ω—å–æ–≥–æ —Ä–µ–ª–∞–∫—Å—É"); showStep(4);
        }

        function goBack(stepNumber) {
            if(stepNumber === 1) updateHeader("–û–±–µ—Ä—ñ—Ç—å –¥–∞—Ç–∏ –≤—ñ–¥–ø–æ—á–∏–Ω–∫—É ‚öì", "–ö–æ–ª–∏ –ø–ª–∞–Ω—É—î—Ç–µ –∑–∞—ó–∑–¥ —Ç–∞ –≤–∏—ó–∑–¥?");
            if(stepNumber === 2) updateHeader("–°–∫—ñ–ª—å–∫–∏ –≤–∞—Å –±—É–¥–µ?", "–í–∫–∞–∂—ñ—Ç—å –∫—ñ–ª—å–∫—ñ—Å—Ç—å –æ—Å—ñ–±");
            if(stepNumber === 3) updateHeader("–í–∏ –∑ –ø—É—Ö–Ω–∞—Å—Ç–∏–∫–æ–º?", "–ú–∏ –¥—Ä—É–∂–Ω—ñ –¥–æ —Ç–≤–∞—Ä–∏–Ω");
            showStep(stepNumber);
        }

        function submitData(chanAnswer) {
            if (!userId) { alert("–ü–æ–º–∏–ª–∫–∞: –í—ñ–¥–∫—Ä–∏–π—Ç–µ —á–µ—Ä–µ–∑ –±–æ—Ç–∞."); return; }

            document.querySelectorAll('.step-container').forEach(el => el.style.display = 'none');
            const msgDiv = document.getElementById('message');
            msgDiv.style.display = 'block';
            updateHeader("–ú–∞–π–∂–µ –≥–æ—Ç–æ–≤–æ!", "–ü–∞–∫—É—î–º–æ –≤–∞—à—ñ –¥–∞–Ω—ñ...");

            const googleUrl = "https://script.google.com/macros/s/AKfycbwQNcWFZPXQHNY4VRUUujMIqJsHXA5O-vNmvKICxwQfiJfQH71AZlHQUU74OSFfwEOxrw/exec";
            const finalUrl = `${googleUrl}?userId=${userId}&checkIn=${finalCheckIn}&checkOut=${finalCheckOut}&guests=${finalGuests}&pets=${finalPets}&chan=${chanAnswer}`;

            fetch(finalUrl, { mode: 'no-cors' })
                .then(() => {
                    msgDiv.style.color = "#4CAF50"; 
                    msgDiv.innerText = "‚úÖ –ì–æ—Ç–æ–≤–æ! –ü–æ–≤–µ—Ä—Ç–∞–π—Ç–µ—Å—è –≤ Telegram";
                    setTimeout(() => { if (tg) tg.close(); }, 2000);
                })
                .catch(e => {
                    msgDiv.style.color = "#4CAF50";
                    msgDiv.innerText = "‚úÖ –î–∞—Ç–∏ –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ! –ú–æ–∂–µ—Ç–µ –∑–∞–∫—Ä–∏—Ç–∏ –≤—ñ–∫–Ω–æ.";
                    setTimeout(() => { if (tg) tg.close(); }, 2000);
                });
        }
    </script>
</body>
</html>
