<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–í—ñ–ª—å–Ω—ñ –¥–∞—Ç–∏ - BOSO</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <style>
        body { font-family: 'Segoe UI', sans-serif; padding: 20px; text-align: center; background-color: #f9f6f0; }
        .bosman-avatar { width: 100px; height: 100px; border-radius: 50%; border: 4px solid #8f9779; margin-bottom: 10px; object-fit: cover; }
        h2 { color: #2c3e50; font-size: 20px; margin-top: 5px; margin-bottom: 5px; }
        p.subtitle { color: #7f8c8d; font-size: 14px; margin-top: 0; margin-bottom: 15px; }
        
        /* –°—Ç–∏–ª—ñ –¥–ª—è –≤–∏–ø–∞–¥–∞—é—á–æ–≥–æ —Å–ø–∏—Å–∫—É */
        .select-css {
            display: block; font-size: 16px; font-family: sans-serif; font-weight: 700; color: #444; line-height: 1.3;
            padding: .6em 1.4em .5em .8em; width: 100%; max-width: 300px; box-sizing: border-box; margin: 0 auto 20px auto;
            border: 2px solid #8f9779; box-shadow: 0 1px 0 1px rgba(0,0,0,.04); border-radius: 8px;
            -moz-appearance: none; -webkit-appearance: none; appearance: none; background-color: #fff;
            background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%238f9779%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E');
            background-repeat: no-repeat, repeat; background-position: right .7em top 50%, 0 0; background-size: .65em auto, 100%; outline: none;
        }

        #calendar-container { background: white; padding: 15px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); display: inline-block; margin-bottom: 20px; }
        #loader { color: #8f9779; font-weight: bold; margin-bottom: 15px; }
        
        .flatpickr-day { pointer-events: none !important; border-radius: 8px !important; } 
        .flatpickr-day.booked-date { background-color: #e74c3c !important; color: white !important; border: none !important; opacity: 0.8; }
        .flatpickr-day.free-date { background-color: #2ecc71 !important; color: white !important; border: none !important; }
        .flatpickr-day.flatpickr-disabled { background-color: transparent !important; color: #ccc !important; }
    </style>
</head>
<body>

    <img src="bosman.jpg" alt="–ö–∞–ø—ñ—Ç–∞–Ω –ë–æ—Å–º–∞–Ω" class="bosman-avatar" onerror="this.src='https://via.placeholder.com/100?text=BOSO'">
    <h2>–î–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∫–æ—Ç–µ–¥–∂—ñ–≤ ‚öì</h2>
    <p class="subtitle">üî¥ –ó–∞–π–Ω—è—Ç–æ | üü¢ –í—ñ–ª—å–Ω–æ</p>

    <select id="cottageSelect" class="select-css" onchange="loadCalendarDates()">
        <option value="65e8865b5cc7538d464e3f77">JUNIOR 1 (–∫–æ—Ç–µ–¥–∂ –¥–ª—è –¥–≤–æ—Ö)</option>
        <option value="65e8834e5cc7538d464e3b46">FAMILY ‚Ññ2 (—Å—ñ–º–µ–π–Ω–∏–π –∫–æ—Ç–µ–¥–∂)</option>
        <option value="65e8863a5cc7538d464e3eab">FAMILY ‚Ññ3 (—Å—ñ–º–µ–π–Ω–∏–π –∫–æ—Ç–µ–¥–∂)</option>
        <option value="65e886505cc7538d464e3f1d">FAMILY ‚Ññ4 (—Å—ñ–º–µ–π–Ω–∏–π –∫–æ—Ç–µ–¥–∂)</option>
    </select>

    <div id="loader">‚è≥ –ó–≤—ñ—Ä—è—î–º–æ –±–æ—Ä—Ç–æ–≤—ñ –∂—É—Ä–Ω–∞–ª–∏...</div>

    <div id="calendar-container" style="display: none;">
        <input type="text" id="inlineCalendar" style="display:none;">
    </div>

    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://npmcdn.com/flatpickr/dist/l10n/uk.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <script>
        const tg = window.Telegram.WebApp;
        if (tg) { tg.expand(); tg.ready(); }

        // –¢–≤–æ—î –±–æ–π–æ–≤–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ —Ä–æ–∑–≤—ñ–¥–∫—É –¥–∞—Ç
        const googleScriptUrl = "https://script.google.com/macros/s/AKfycbzsTNRpYZ38kHrurbQ9q289W7PJdrPDr614Zjc07FiyMy663CJowAl_Rtnsftwb_jQQ/exec";

        let fpInstance = null; 

        function loadCalendarDates() {
            const selectedRoomId = document.getElementById('cottageSelect').value;
            
            document.getElementById('loader').style.display = 'block';
            document.getElementById('calendar-container').style.display = 'none';

            fetch(`${googleScriptUrl}?roomId=${selectedRoomId}`)
                .then(response => response.json())
                .then(disabledDatesArray => {
                    document.getElementById('loader').style.display = 'none';
                    document.getElementById('calendar-container').style.display = 'inline-block';

                    const bookedDatesSet = new Set(disabledDatesArray);

                    if (fpInstance) {
                        fpInstance.destroy();
                    }

                    fpInstance = flatpickr("#inlineCalendar", {
                        inline: true,
                        locale: "uk",
                        minDate: "today",
                        showMonths: 1,
                        onDayCreate: function(dObj, dStr, fp, dayElem) {
                            const dateStrFormatted = fp.formatDate(dayElem.dateObj, "Y-m-d");
                            const today = new Date();
                            today.setHours(0,0,0,0);

                            if (dayElem.dateObj >= today) {
                                if (bookedDatesSet.has(dateStrFormatted)) {
                                    dayElem.classList.add("booked-date");
                                } else {
                                    dayElem.classList.add("free-date");
                                }
                            }
                        }
                    });
                })
                .catch(error => {
                    document.getElementById('loader').innerText = "‚ùå –®—Ç–æ—Ä–º –Ω–∞ –ª—ñ–Ω—ñ—ó –∑–≤'—è–∑–∫—É. –°–ø—Ä–æ–±—É–π—Ç–µ –ø—ñ–∑–Ω—ñ—à–µ.";
                });
        }

        window.onload = () => {
            const urlParams = new URLSearchParams(window.location.search);
            const roomIdFromUrl = urlParams.get('room_id');
            const selectElem = document.getElementById('cottageSelect');
            
            if (roomIdFromUrl) {
                for(let i=0; i < selectElem.options.length; i++) {
                    if(selectElem.options[i].value === roomIdFromUrl) {
                        selectElem.selectedIndex = i;
                        break;
                    }
                }
            }
            loadCalendarDates();
        };
    </script>
</body>
</html>
