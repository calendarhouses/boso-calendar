<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–í—ñ–ª—å–Ω—ñ –¥–∞—Ç–∏ - BOSO</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <style>
        body { font-family: 'Segoe UI', sans-serif; padding: 20px; text-align: center; background-color: #f9f6f0; }
        .bosman-avatar { width: 100px; height: 100px; border-radius: 50%; border: 4px solid #8f9779; margin-bottom: 10px; object-fit: cover; }
        h2 { color: #2c3e50; font-size: 20px; margin-top: 5px; margin-bottom: 5px; }
        p.subtitle { color: #7f8c8d; font-size: 14px; margin-top: 0; margin-bottom: 20px; }
        
        #calendar-container { background: white; padding: 15px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); display: inline-block; margin-bottom: 20px; }
        #loader { color: #8f9779; font-weight: bold; margin-bottom: 15px; }
        
        button { background-color: #8f9779; color: white; border: none; padding: 15px; width: 100%; max-width: 320px; border-radius: 8px; font-weight: bold; font-size: 16px; cursor: pointer; transition: 0.2s; margin: 0 auto; }
        
        /* –ú–ê–ì–Ü–Ø CSS –î–õ–Ø –¢–ê–ë–õ–û */
        /* 1. –í—ñ–¥–∫–ª—é—á–∞—î–º–æ –∫–ª—ñ–∫–∏ –ø–æ –¥–Ω—è—Ö */
        .flatpickr-day { pointer-events: none !important; border-radius: 8px !important; } 
        
        /* 2. –°—Ç–∏–ª—å –¥–ª—è –∑–∞–π–Ω—è—Ç–∏—Ö –¥–∞—Ç (–ß–ï–†–í–û–ù–ò–ô) */
        .flatpickr-day.booked-date { background-color: #e74c3c !important; color: white !important; border: none !important; opacity: 0.8; }
        
        /* 3. –°—Ç–∏–ª—å –¥–ª—è –≤—ñ–ª—å–Ω–∏—Ö –¥–∞—Ç (–ó–ï–õ–ï–ù–ò–ô) */
        .flatpickr-day.free-date { background-color: #2ecc71 !important; color: white !important; border: none !important; }
        
        /* –©–æ–± –º–∏–Ω—É–ª—ñ –¥–Ω—ñ –∑–∞–ª–∏—à–∞–ª–∏—Å—è —Å—ñ—Ä–∏–º–∏, –∞ –Ω–µ –∑–µ–ª–µ–Ω–∏–º–∏ */
        .flatpickr-day.flatpickr-disabled { background-color: transparent !important; color: #ccc !important; }
    </style>
</head>
<body>

    <img src="bosman.jpg" alt="–ö–∞–ø—ñ—Ç–∞–Ω –ë–æ—Å–º–∞–Ω" class="bosman-avatar" onerror="this.src='https://via.placeholder.com/100?text=BOSO'">
    <h2>–î–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∫–æ—Ç–µ–¥–∂—É ‚öì</h2>
    <p class="subtitle">üî¥ –ó–∞–π–Ω—è—Ç–æ | üü¢ –í—ñ–ª—å–Ω–æ</p>

    <div id="loader">‚è≥ –ö–∞–ø—ñ—Ç–∞–Ω –ø–µ—Ä–µ–≤—ñ—Ä—è—î –±–æ—Ä—Ç–æ–≤—ñ –∂—É—Ä–Ω–∞–ª–∏...</div>

    <div id="calendar-container" style="display: none;">
        <input type="text" id="inlineCalendar" style="display:none;">
    </div>

    <button onclick="closeApp()">–ü–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—è –≤ —á–∞—Ç</button>

    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://npmcdn.com/flatpickr/dist/l10n/uk.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <script>
        const tg = window.Telegram.WebApp;
        if (tg) { tg.expand(); tg.ready(); }

        const urlParams = new URLSearchParams(window.location.search);
        const roomId = urlParams.get('room_id');
        
        // ‚ö†Ô∏è –ü–û–°–ò–õ–ê–ù–ù–Ø –ù–ê –¢–í–û–Æ –ù–û–í–£ –†–û–ó–í–Ü–î–ö–£ –î–ê–¢ –£ GOOGLE SCRIPT
        const googleScriptUrl = "https://script.google.com/macros/s/AKfycbzsTNRpYZ38kHrurbQ9q289W7PJdrPDr614Zjc07FiyMy663CJowAl_Rtnsftwb_jQQ/exec";

        fetch(`${googleScriptUrl}?roomId=${roomId}`)
            .then(response => response.json())
            .then(disabledDatesArray => {
                document.getElementById('loader').style.display = 'none';
                document.getElementById('calendar-container').style.display = 'inline-block';

                // –°—Ç–≤–æ—Ä—é—î–º–æ "–°–ª–æ–≤–Ω–∏–∫" –∑–∞–π–Ω—è—Ç–∏—Ö –¥–∞—Ç –¥–ª—è —à–≤–∏–¥–∫–æ–≥–æ –ø–æ—à—É–∫—É
                const bookedDatesSet = new Set(disabledDatesArray);

                flatpickr("#inlineCalendar", {
                    inline: true,
                    locale: "uk",
                    minDate: "today",
                    showMonths: 1, // –ú–æ–∂–µ—à –∑–º—ñ–Ω–∏—Ç–∏ –Ω–∞ 2, —è–∫—â–æ —Ö–æ—á–µ—à –ø–æ–∫–∞–∑—É–≤–∞—Ç–∏ –æ–¥—Ä–∞–∑—É –¥–≤–∞ –º—ñ—Å—è—Ü—ñ
                    onDayCreate: function(dObj, dStr, fp, dayElem) {
                        // –û—Ç—Ä–∏–º—É—î–º–æ –¥–∞—Ç—É –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –¥–Ω—è —É —Ñ–æ—Ä–º–∞—Ç—ñ YYYY-MM-DD
                        const dateStrFormatted = fp.formatDate(dayElem.dateObj, "Y-m-d");
                        
                        // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —â–æ–± —Ä–æ–∑—Ñ–∞—Ä–±–æ–≤—É–≤–∞—Ç–∏ —Ç—ñ–ª—å–∫–∏ –º–∞–π–±—É—Ç–Ω—ñ –¥–∞—Ç–∏ —Ç–∞ —Å—å–æ–≥–æ–¥–Ω—ñ
                        const today = new Date();
                        today.setHours(0,0,0,0);

                        if (dayElem.dateObj >= today) {
                            if (bookedDatesSet.has(dateStrFormatted)) {
                                // –Ø–∫—â–æ –¥–∞—Ç–∞ —î –≤ —Å–ø–∏—Å–∫—É –≤—ñ–¥ Google Script -> —Ä–æ–±–∏–º–æ —á–µ—Ä–≤–æ–Ω–æ—é
                                dayElem.classList.add("booked-date");
                            } else {
                                // –Ø–∫—â–æ –¥–∞—Ç–∏ –Ω–µ–º–∞—î –≤ —Å–ø–∏—Å–∫—É -> —Ä–æ–±–∏–º–æ –∑–µ–ª–µ–Ω–æ—é
                                dayElem.classList.add("free-date");
                            }
                        }
                    }
                });
            })
            .catch(error => {
                document.getElementById('loader').innerText = "‚ùå –®—Ç–æ—Ä–º –Ω–∞ –ª—ñ–Ω—ñ—ó –∑–≤'—è–∑–∫—É. –°–ø—Ä–æ–±—É–π—Ç–µ –ø—ñ–∑–Ω—ñ—à–µ.";
            });

        function closeApp() {
            if (tg) tg.close();
        }
    </script>
</body>
</html>
